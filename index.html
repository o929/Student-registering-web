<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hospital Appointment System</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 20px; }
    table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #555; color: white; }
    input, select { width: 100%; padding: 8px; border: 1px solid #ccc; }
    button { padding: 8px 12px; border: none; cursor: pointer; border-radius: 4px; }
    .edit { background: #28a745; color: white; }
    .delete { background: #dc3545; color: white; }
    tr.disabled input, tr.disabled select { background: #eee; pointer-events: none; }
    .confirm { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 999; };
      td:nth-child(2) input { /* Age column */
  width: 20px;
}

td:nth-child(6) input { /* Complaint column */
  width: 100%;
  min-width: 300px;
}

  </style>
</head>
<body>

<h2>Hospital Patient Appointment</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Age</th>
      <th>Sex</th>
      <th>Address</th>
      <th>Kind of Appointment</th>
      <th>Complaint</th>
      <th>Edit</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody id="patientTable"></tbody>
</table>
<button id="ddd"></button>
<div class="confirm" id="confirmBox">
  <p>Are you sure you want to delete this record?</p>
  <button id="confirmYes" onclick="confirmDelete(true)">Yes</button>
  <button onclick="confirmDelete(false)">No</button>
</div>

<script>
  const fields = ["name", "age", "sex", "address", "type", "complaint"];
  const rowCount = 45;
  document.getElementById("ddd").value
  let currentDeleteId = null;

  const patientTable = document.getElementById("patientTable");
  const confirmBox = document.getElementById("confirmBox");

  const createRow = (id) => {
    const tr = document.createElement("tr");
    tr.dataset.id = id;

    tr.innerHTML = `
      <td><input id="name${id}" /></td>
      <td><input id="age${id}" type="number" /></td>
      <td>
        <select id="sex${id}">
          <option value="">--Select--</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </td>
      <td><input id="address${id}" /></td>
      <td>
        <select id="type${id}">
          <option value="">--Select--</option>
          <option>Checkup</option>
          <option>Emergency</option>
          <option>Follow-up</option>
          <option>Referral</option>
        </select>
      </td>
      <td><input id="complaint${id}" /></td>
      <td><button class="edit" id="editBtn${id}" onclick="toggleEdit(${id})">Save</button></td>
      <td><button class="delete" onclick="askDelete(${id})">Delete</button></td>
    `;
    patientTable.appendChild(tr);
  };

  const toggleInputs = (id, disabled) => {
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (disabled) {
      row.classList.add("disabled");
    } else {
      row.classList.remove("disabled");
    }
  };

  const saveRow = (id) => {
    fields.forEach(f => {
      const input = document.getElementById(`${f}${id}`);
      localStorage.setItem(`${f}${id}`, input.value);
    });
    const btn = document.getElementById(`editBtn${id}`);
    localStorage.setItem(`btnState${id}`, btn.textContent);
  };

  const loadRow = (id) => {
    fields.forEach(f => {
      const el = document.getElementById(`${f}${id}`);
      const val = localStorage.getItem(`${f}${id}`);
      if (val !== null) el.value = val;
    });
    const state = localStorage.getItem(`btnState${id}`) || "Save";
    const btn = document.getElementById(`editBtn${id}`);
    btn.textContent = state;
    toggleInputs(id, state === "Edit");
  };

  const toggleEdit = (id) => {
    const btn = document.getElementById(`editBtn${id}`);
    const isEdit = btn.textContent === "Edit";
    btn.textContent = isEdit ? "Save" : "Edit";
    toggleInputs(id, !isEdit);
    saveRow(id);
  };

  const askDelete = (id) => {
    currentDeleteId = id;
    confirmBox.style.display = "block";
        // Add one-time click event to body
                document.removeEventListener('click',hideConfirmingBox)

    setTimeout(() => {
        document.addEventListener("click", hideConfirmingBox);
    }, 0);
  };
function hideConfirmingBox(){
                confirmDialog = document.getElementById("confirmBox")
                confirmDialog.style.display = "none";
                document.removeEventListener('click',hideConfirmingBox)
}

  const confirmDelete = (doDelete) => {
    if (doDelete && currentDeleteId) {
      fields.forEach(f => {
        const el = document.getElementById(`${f}${currentDeleteId}`);
        el.value = "";
        el.disabled = false;
        localStorage.setItem(`${f}${currentDeleteId}`, "");
      });
      const btn = document.getElementById(`editBtn${currentDeleteId}`);
      btn.textContent = "Save";
      toggleInputs(currentDeleteId, false);
      localStorage.setItem(`btnState${currentDeleteId}`, "Save");
    }
    confirmBox.style.display = "none";
  };

  for (let i = 1; i <= rowCount; i++) createRow(i);
  window.onload = () => {
    for (let i = 1; i <= rowCount; i++) loadRow(i);
  };
</script>

</body>
</html>
